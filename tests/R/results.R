library(dplyr)
library(readr)

results <- "tests/data/test.csv" %>%
  readr::read_csv(col_names = "score")

summary <- results %>%
  dplyr::group_by(score) %>%
  dplyr::summarise(count = n()) %>%
  dplyr::mutate(pct = paste0(round(count / nrow(results) * 100, 2), "%"))

wins <- results %>%
  dplyr::filter(score > 0)

hist(as.numeric(wins$score), breaks = length(unique(wins$score)))

mean(wins$score)

### NEW STUFF ? ###

library(dplyr)
library(ggplot2)
library(readr)

read2 <- function(id = "", tbl) {
  tbl %>%
    readr::read_csv(col_names = "score") %>%
    dplyr::mutate(id = id)
}

summary2 <- function(tbl) {
  tbl %>%
    dplyr::group_by(id, score) %>%
    dplyr::summarise(count = n()) %>%
    dplyr::mutate(pct = paste0(round(count / nrow(tbl) * 100, 2), "%"))
}

# comparing runtimes
opt_lightning <- read2("new-opt-lightning", "tests/data/simulation-optimized-1000.csv")
results <- list(
  "old-broken" = read2("old-broken", "tests/data/test-old-100k.csv"),
  "new-fixed" = read2("new-fixed", "tests/data/test-new-100k.csv"),
  "new-info" = read2("new-info", "tests/data/test-new-autoplayer.csv"),
  "new-opt" = tibble::tibble(
    id = "new-opt",
    score = c(6, 4, 2, 6, 4, 4, 4, 4, 4, 4, 3, 3, 4, 4, 4, 4, 4, 2, 3, 3, 5, 0, 5, 3, 2, 3, 3, 0, 4, 4, 0, 4, 5, 5, 4, 5, 4, 4, 4, 5, 3, 5, 4, 3, 6, 4, 5, 4, 0, 5, 5, 3, 3, 4, 4, 4, 3, 3, 2, 5, 4, 4, 5, 3, 3, 4, 3, 3, 5, 3, 4, 5, 4, 2, 4, 5, 4, 3, 4, 4, 4, 4, 3, 3, 3, 5, 4, 3, 4, 4, 4, 3, 4, 4, 6, 4, 4, 4, 3, 4, 4, 3, 0, 4, 4, 4, 6, 3, 5, 3, 6, 5, 5, 0, 3, 4, 4, 4, 4, 3, 4, 6, 4, 3, 2, 4, 4, 4, 3, 4, 5, 5, 4, 3, 4, 5, 4, 4, 3, 4, 0, 4, 3, 3, 3, 4, 4, 5, 4, 3, 5, 3, 5, 4, 5, 4, 4, 5, 4, 4, 4, 4, 4, 6, 5, 6, 4, 5, 0, 0, 5, 3, 4, 5, 6, 5, 4, 3, 4, 2, 5, 3, 3, 3, 4, 3, 4, 3, 4, 4, 4, 3, 0, 4, 5, 3, 4, 5, 6, 4, 3, 3, 0, 4, 4, 3, 5, 4, 4, 4, 3, 4, 4, 4, 4, 3, 5, 4, 5, 4, 4, 2, 5, 6, 4, 0, 3, 4, 4, 4, 6, 5, 6, 0, 4, 4, 3, 5, 3, 3, 3, 6, 5, 6, 3, 3, 4, 4, 5, 3, 3, 3, 5, 4, 3, 3, 4, 4, 4, 4, 4, 5, 5, 4, 6, 3, 3, 4, 4, 5, 4, 4, 4, 6, 4, 4, 4, 0, 5, 5, 4, 6, 0, 0, 6, 4, 4, 4, 4, 4, 4, 3, 3, 3, 4, 3, 4, 0, 3, 5, 6, 3, 3, 0, 4, 3, 6, 5, 3, 4, 3, 3, 4, 5, 6, 4, 5, 4, 3, 4, 4, 3, 4, 4, 3, 4, 5, 4, 3, 5, 6, 4, 4, 4, 4, 3, 3, 3, 5, 6, 4, 3, 4, 4, 4, 3, 4, 4, 5, 4, 3, 5, 5, 4, 4, 5, 4, 5, 6, 3, 5, 4, 3, 4, 5, 6, 3, 3, 4, 4, 3, 5, 4, 4, 6, 5, 4, 4, 5, 4, 3, 4, 4, 4, 3, 5, 5, 4, 4, 3, 5, 0, 0, 3, 6, 5, 2, 3, 4, 4, 5, 6, 6, 6, 4, 4, 5, 4, 4, 4, 5, 3, 3, 4, 5, 4, 5, 3, 4, 5, 4, 6, 5, 2, 3, 3, 4, 0, 3, 3, 5, 2, 4, 4, 3, 4, 3, 4, 3, 0, 4, 4, 4, 4, 4, 4, 4, 5, 3, 0, 3, 5, 5, 5, 3, 4, 4, 3, 4, 4, 6, 6, 4, 5, 4, 4, 4, 3, 5, 5, 4, 6, 4, 0, 4, 5, 4, 6, 4, 4, 5, 4, 4, 3, 3, 4, 5, 3, 4, 5, 4, 3, 4, 6, 4, 4, 4, 4, 0, 5, 5, 5, 0, 3, 4, 3, 4, 4, 4, 5, 5, 3, 3, 4, 3, 4, 5, 4, 4, 3, 5, 0, 3, 4, 3, 4, 4, 6, 3, 4, 4, 5, 3, 3, 5, 3, 4, 4, 4, 4, 5, 4, 3, 6, 3, 5, 3, 2, 4, 5, 4, 4, 3, 3, 5, 4, 4, 5, 3, 4, 5, 5, 6, 3, 3, 0, 4, 3, 0, 4, 5, 5, 4, 5, 5, 4, 3, 3, 6, 4, 5, 3, 5, 5, 2, 4, 4, 0, 4, 5, 4, 4, 4, 5, 3, 4, 5, 4, 4, 4, 4, 5, 6, 3, 3, 4, 4, 4, 3, 5, 5, 4, 5, 4, 4, 4, 3, 5, 5, 3, 4, 3, 4, 4, 5, 4, 6, 3, 6, 3, 3, 4, 6, 4, 5, 3, 2, 5, 5, 4, 4, 3, 4, 0, 5)
  ),
  "new-opt-ub" = tibble::tibble(
    id = "new-opt-ub",
    score = c(7, 4, 6, 5, 5, 4, 4, 2, 4, 5, 6, 4, 4, 4, 3, 3, 4, 4, 5, 3, 4, 5, 4, 3, 5, 3, 4, 4, 3, 3, 4, 4, 5, 3, 6, 5, 3, 4, 4, 5, 4, 4, 4, 3, 4, 3, 3, 4, 4, 4, 4, 6, 5, 7, 6, 3, 5, 5, 4, 4, 4, 4, 3, 2, 5, 6, 4, 3, 5, 7, 4, 5, 3, 4, 4, 4, 3, 5, 5, 4, 4, 4, 4, 3, 3, 3, 7, 3, 4, 4, 4, 5, 3, 7, 4, 4, 5, 5, 3, 4, 2, 4, 4, 4, 3, 4, 2, 4, 2, 4, 8, 4, 4, 4, 4, 5, 4, 8, 5, 3, 5, 6, 4, 3, 4, 4, 6, 3, 5, 3, 4, 4, 4, 3, 6, 3, 4, 4, 6, 4, 4, 3, 3, 5, 6, 3, 4, 4, 5, 3, 3, 3, 4, 5, 4, 3, 3, 5, 3, 2, 4, 3, 4, 4, 5, 4, 5, 6, 4, 3, 3, 7, 4, 4, 3, 4, 4, 3, 6, 3, 4, 5, 4, 7, 3, 3, 4, 3, 4, 4, 3, 3, 5, 4, 3, 4, 5, 8, 8, 4, 3, 4, 3, 4, 4, 4, 5, 5, 3, 4, 5, 3, 4, 4, 5, 4, 4, 4, 4, 5, 5, 3, 5, 4, 5, 5, 4, 4, 6, 4, 4, 5, 3, 4, 3, 5, 4, 3, 3, 3, 3, 4, 4, 4, 3, 4, 4, 4, 5, 4, 7, 5, 4, 5, 4, 4, 4, 4, 7, 4, 6, 4, 3, 3, 3, 5, 5, 2, 4, 4, 3, 4, 5, 5, 4, 4, 3, 4, 4, 4, 6, 4, 6, 5, 4, 4, 5, 3, 8, 4, 7, 4, 4, 5, 5, 4, 4, 4, 5, 5, 4, 4, 3, 3, 3, 3, 4, 4, 5, 5, 4, 5, 4, 5, 4, 3, 5, 4, 5, 3, 6, 4, 4, 3, 5, 3, 3, 4, 3, 4, 3, 4, 5, 3, 7, 6, 4, 3, 4, 5, 5, 4, 4, 4, 5, 4, 4, 4, 3, 5, 4, 5, 4, 6, 4, 6, 5, 4, 5, 3, 3, 5, 4, 4, 3, 6, 6, 4, 3, 5, 3, 4, 4, 4, 5, 3, 4, 3, 4, 4, 4, 4, 3, 3, 4, 4, 6, 4, 4, 4, 6, 3, 6, 5, 4, 4, 6, 4, 4, 4, 3, 4, 5, 4, 3, 5, 4, 3, 4, 3, 4, 4, 5, 4, 5, 3, 5, 5, 5, 3, 4, 5, 3, 3, 5, 4, 4, 7, 5, 3, 5, 3, 4, 5, 5, 4, 3, 4, 4, 4, 4, 4, 4, 4, 3, 5, 4, 5, 5, 4, 3, 5, 3, 4, 4, 3, 3, 3, 2, 5, 3, 2, 4, 3, 4, 4, 4, 4, 6, 4, 5, 5, 4, 4, 5, 6, 4, 3, 3, 5, 3, 3, 3, 4, 4, 3, 2, 4, 3, 5, 5, 5, 2, 3, 5, 3, 5, 5, 3, 10, 4, 4, 4, 4, 3, 3, 4, 5, 4, 5, 3, 4, 4, 4, 5, 5, 3, 4, 4, 3, 4, 2, 5, 8, 5, 3, 4, 4, 4, 4, 4, 4, 3, 5, 3, 6, 4, 5, 3, 4, 6, 3, 4, 4, 3, 4, 4, 3, 10, 5, 4, 4, 5, 4, 3, 3, 4, 9, 4, 6, 4, 4, 5, 5, 4, 4, 3, 4, 6, 3, 5, 4, 3, 4, 5, 11, 3, 5, 2, 4, 4, 4, 4, 4, 4, 4, 5, 4, 4, 3, 6, 6, 3, 3, 6, 4, 4, 5, 4, 4, 3, 4, 6, 4, 6, 3, 5, 5, 4, 4, 3, 3, 5, 4, 4, 3, 4, 2, 4, 5, 5, 5, 4, 4, 5, 3, 3, 6, 5, 3, 4, 4, 4, 2, 5, 5, 6, 2, 4, 4, 5, 5, 5,
              3, 4, 4, 4, 3, 4, 5, 6, 4, 3, 4, 4, 3, 4, 5, 4, 5, 4, 4, 4, 3, 3, 3, 7, 4, 3, 3, 4, 4, 6, 4, 3, 3, 6, 3, 4, 3, 3, 6, 5, 4, 4, 5, 4, 3, 5, 5, 6, 3, 4, 3, 5, 5, 3, 3, 4, 4, 4, 4, 5, 3, 3, 4, 4, 3, 3, 5, 4, 5, 5, 3, 4, 4, 6, 4, 5, 5, 4, 4, 5, 3, 4, 5, 4, 3, 7, 3, 4, 4, 5, 3, 4, 4, 3, 4, 4, 5, 2, 3, 4, 3, 4, 4, 3, 5, 4, 6, 7, 7, 6, 5, 3, 4, 4, 4, 5, 5, 3, 3, 4, 4, 4, 4, 5, 4, 3, 4, 6, 5, 5, 5, 4, 4, 5, 3, 6, 2, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 3, 5, 10, 4, 3, 4, 4, 4, 4, 4, 4, 4, 6, 4, 5, 4, 6, 4, 4, 4, 5, 6, 5, 5, 4, 5, 3, 5, 6, 4, 3, 4, 5, 3, 3, 4, 4, 4, 4, 6, 6, 6, 7, 4, 4, 5, 2, 6, 6, 3, 5, 3, 4, 8, 3, 4, 5, 4, 4, 3, 4, 3, 4, 4, 4, 4, 3, 4, 4, 3, 6, 5, 3, 5, 9, 4, 5, 5, 3, 4, 4, 6, 4, 4, 4, 5, 3, 3, 4, 4, 5, 4, 3, 4, 4, 6, 5, 4, 3, 4, 4, 4, 4, 3, 5, 4, 4, 5, 3, 3, 2, 4, 5, 3, 5, 6, 2, 5, 7, 6, 4, 4, 4, 4, 3, 5, 3, 3, 4, 4, 3, 5, 5, 3, 5, 4, 5, 7, 3, 3, 5, 4, 4, 4, 3, 4, 4, 5, 3, 4, 3, 3, 4, 3, 4, 3, 3, 5, 5, 3, 4, 3, 6, 6, 3, 3, 7, 5, 7, 3, 6, 6, 4, 3, 4, 4, 4, 3, 3, 5, 4, 6, 3, 4),
  ),
  "opt-lightning" = tibble::tibble(
    id = "opt-lightning",
    score = na.omit(as.vector(unlist(lapply(opt_lightning, function(x) as.integer(x)))))
  )
)

summary <- dplyr::bind_rows(lapply(results, summary2))

wins <- dplyr::bind_rows(results) |>
  dplyr::mutate(score = dplyr::if_else(score <= 0, 0, score))
# %>% dplyr::filter(score > -1)

mean(wins$score)
hist(as.numeric(wins$score), breaks = length(unique(wins$score)))

wins %>%
  ggplot2::ggplot(aes(x = score, color = id, fill = id)) +
  ggplot2::geom_histogram(
    binwidth = 1.2,
    alpha = 0.8,
    position = "dodge"
  ) +
  ggplot2::labs(title = "\nWordle Solver before & after\n", x = "\n# of turns\n", y = "\nfrequency\n") +
  ggplot2::theme(plot.title = element_text(hjust = 0.5))

n_per_group <- wins |>
  group_by(id) |>
  summarise(
    group_n = n()
  )

wins_barchart <- wins %>%
  dplyr::group_by(id, score) %>%
  dplyr::summarise(
    count = n()
  ) %>%
  dplyr::left_join(
    n_per_group,
    by = 'id'
  ) %>%
  dplyr::mutate(
    ratio = count / group_n,
    pct = round(ratio * 100, 2),
    pct_str = paste0(pct, "%")
  )

(wins_barchart %>%
  ggplot2::ggplot(aes(x = score, y = pct, fill = id)) +
  ggplot2::geom_col(width = 1, position = position_dodge(0.7), alpha = 0.9) +
  ggplot2::labs(
    title = paste0(
      "\nWordle Solver before & after (games=",
      prettyNum(
        formatC(nrow(wins) / length(unique(wins$id)), format = "d"),
        big.mark = ","
      ),
      ")\n"
    ),
    x = "\n# of turns (n)\n",
    y = "\nfrequency (pct)\n"
  ) +
  ggplot2::theme(plot.title = element_text(hjust = 0.5))
) |>
  plotly::ggplotly()

